<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perodua Admin Dashboard</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 20px 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h1 {
            color: white;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            color: rgba(255,255,255,0.7);
            font-size: 12px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-menu a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: #ff1744;
        }

        .sidebar-menu a.active {
            background: rgba(255,255,255,0.15);
            color: white;
            border-left-color: #ff1744;
        }

        .sidebar-menu a span {
            margin-right: 15px;
            font-size: 20px;
        }

        /* Main Content Area */
        .main-content {
            margin-left: 260px;
            padding: 30px;
            min-height: 100vh;
        }

        .top-bar {
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-bar h2 {
            color: #1e3c72;
            font-size: 28px;
        }

        .firebase-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: #f0f0f0;
            border-radius: 20px;
            font-size: 13px;
        }

        .firebase-status.connected {
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* Content Sections */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .card h3 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff1744;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group textarea,
        .form-group input[type="file"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff1744;
            box-shadow: 0 0 0 3px rgba(255, 23, 68, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .btn {
            background: #ff1744;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #d50032;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 23, 68, 0.3);
        }

        .btn-secondary {
            background: #667eea;
            font-size: 13px;
            padding: 8px 15px;
        }

        .btn-secondary:hover {
            background: #5568d3;
        }

        .btn-remove {
            background: #f44336;
            font-size: 13px;
            padding: 8px 15px;
        }

        .btn-remove:hover {
            background: #da190b;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .stat-card h4 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .feature-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .feature-input-group input {
            flex: 1;
        }

        .car-models-list {
            margin-top: 20px;
        }

        .car-model-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ff1744;
        }

        .car-model-item h4 {
            color: #ff1744;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .car-model-item p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        .car-model-item img {
            max-width: 200px;
            margin-top: 10px;
            border-radius: 8px;
        }

        .contact-item {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .contact-item:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-color: #ff1744;
        }

        .contact-item.new {
            border-left: 5px solid #4caf50;
            background: #f1f8f4;
        }

        .contact-item.contacted {
            border-left: 5px solid #9e9e9e;
            opacity: 0.8;
        }

        .contact-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .contact-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .contact-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .contact-status.new {
            background: #4caf50;
            color: white;
        }

        .contact-status.contacted {
            background: #9e9e9e;
            color: white;
        }

        .contact-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .contact-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 14px;
        }

        .contact-message {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .contact-message p {
            color: #666;
            line-height: 1.6;
            margin: 0;
        }

        .contact-actions {
            display: flex;
            gap: 10px;
        }

        .contact-timestamp {
            color: #999;
            font-size: 12px;
            margin-top: 10px;
        }

        .image-preview {
            margin-top: 10px;
            max-width: 200px;
            border-radius: 8px;
            overflow: hidden;
        }

        .image-preview img {
            width: 100%;
            display: block;
        }

        .logo-preview {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 10px;
        }

        .logo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .success-message, .error-message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s;
        }

        .success-message {
            background: #4caf50;
            color: white;
        }

        .error-message {
            background: #f44336;
            color: white;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Custom Modal Styles */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s;
        }

        .custom-modal-overlay.show {
            display: flex;
        }

        .custom-modal {
            background: white;
            border-radius: 12px;
            padding: 0;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s;
            overflow: hidden;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .custom-modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .custom-modal-header.warning {
            background: #fff3cd;
            border-bottom-color: #ffc107;
        }

        .custom-modal-header.success {
            background: #e8f5e9;
            border-bottom-color: #4caf50;
        }

        .custom-modal-header.error {
            background: #ffebee;
            border-bottom-color: #f44336;
        }

        .custom-modal-icon {
            font-size: 28px;
        }

        .custom-modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .custom-modal-body {
            padding: 25px;
            color: #666;
            line-height: 1.6;
            font-size: 15px;
        }

        .custom-modal-footer {
            padding: 15px 25px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .custom-modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .custom-modal-btn-cancel {
            background: #f5f5f5;
            color: #666;
        }

        .custom-modal-btn-cancel:hover {
            background: #e0e0e0;
        }

        .custom-modal-btn-confirm {
            background: #ff1744;
            color: white;
        }

        .custom-modal-btn-confirm:hover {
            background: #d50032;
        }

        .custom-modal-btn-ok {
            background: #ff1744;
            color: white;
        }

        .custom-modal-btn-ok:hover {
            background: #d50032;
        }

        .config-warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #856404;
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: #1e3c72;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .sidebar.mobile-hidden {
            transform: translateX(-100%);
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .services-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .custom-modal {
                max-width: 95%;
                margin: 20px;
            }

            .custom-modal-header {
                padding: 15px 20px;
            }

            .custom-modal-title {
                font-size: 18px;
            }

            .custom-modal-body {
                padding: 20px;
                font-size: 14px;
            }

            .custom-modal-footer {
                padding: 12px 20px;
                flex-direction: column;
            }

            .custom-modal-btn {
                width: 100%;
            }

            body {
                padding: 0;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                width: 280px;
                height: 100vh;
                z-index: 1000;
                transform: translateX(0);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-hidden {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
                padding: 80px 15px 20px 15px;
            }

            .top-bar {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                padding: 15px;
            }

            .top-bar h2 {
                font-size: 22px;
            }

            .firebase-status {
                font-size: 12px;
                padding: 6px 12px;
            }

            .card {
                padding: 20px 15px;
                border-radius: 8px;
            }

            .card h3 {
                font-size: 18px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-card .value {
                font-size: 24px;
            }

            .stats-grid,
            .services-grid {
                grid-template-columns: 1fr;
            }

            .form-group input,
            .form-group textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .btn {
                width: 100%;
                padding: 14px 20px;
            }

            .btn-secondary,
            .btn-remove {
                width: auto;
                flex: 1;
            }

            .contact-details {
                grid-template-columns: 1fr;
            }

            .contact-actions {
                flex-direction: column;
            }

            .contact-actions button {
                width: 100%;
            }

            .contact-header {
                flex-direction: column;
                gap: 10px;
            }

            .feature-input-group {
                flex-direction: column;
            }

            .car-model-item img {
                max-width: 100%;
            }

            .image-preview,
            .logo-preview {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 70px 10px 15px 10px;
            }

            .top-bar h2 {
                font-size: 18px;
            }

            .card {
                padding: 15px 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-card h4 {
                font-size: 12px;
            }

            .stat-card .value {
                font-size: 20px;
            }

            .contact-name {
                font-size: 16px;
            }

            .btn {
                font-size: 14px;
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h1>üöó Perodua</h1>
            <p>Admin Dashboard</p>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" onclick="showSection('dashboard')" class="active"><span>üìä</span> Dashboard</a></li>
            <li><a href="#" onclick="showSection('contacts')"><span>üìß</span> Contacts</a></li>
            <li><a href="#" onclick="showSection('cars')"><span>üöô</span> Car Models</a></li>
            <li><a href="#" onclick="showSection('banner')"><span>üì¢</span> Banner Settings</a></li>
            <li><a href="#" onclick="showSection('personal')"><span>üë§</span> Personal Info</a></li>
            <li><a href="#" onclick="showSection('gallery')"><span>üì∏</span> Delivered Cars Gallery</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
            <h2 id="pageTitle">Dashboard</h2>
            <div class="firebase-status" id="firebaseStatusBar">
                <span>üî¥</span>
                <span>Disconnected</span>
            </div>
        </div>

        <!-- Messages -->
        <div id="successMessage" class="success-message"></div>
        <div id="errorMessage" class="error-message"></div>

        <!-- Custom Modal Overlay -->
        <div id="customModalOverlay" class="custom-modal-overlay">
            <div class="custom-modal">
                <div class="custom-modal-header" id="customModalHeader">
                    <span class="custom-modal-icon" id="customModalIcon">‚ö†Ô∏è</span>
                    <h3 class="custom-modal-title" id="customModalTitle">Confirm Action</h3>
                </div>
                <div class="custom-modal-body" id="customModalBody">
                    Are you sure you want to proceed?
                </div>
                <div class="custom-modal-footer" id="customModalFooter">
                    <button class="custom-modal-btn custom-modal-btn-cancel" id="customModalCancel">Cancel</button>
                    <button class="custom-modal-btn custom-modal-btn-confirm" id="customModalConfirm">Confirm</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h4>Total Cars</h4>
                    <div class="value" id="totalCars">0</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h4>Firebase Status</h4>
                    <div class="value" id="dashFirebaseStatus">‚ùå</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <h4>Last Updated</h4>
                    <div class="value" style="font-size: 16px;" id="lastUpdated">-</div>
                </div>
            </div>

            <div class="card">
                <h3>Welcome to Perodua Admin Dashboard</h3>
                <p style="color: #666; line-height: 1.6;">
                    Use the sidebar menu to navigate between different sections. You can manage your banner, personal information, and car models all from this dashboard.
                </p>
                <p style="color: #666; line-height: 1.6; margin-top: 15px;">
                    <strong>Quick Actions:</strong>
                </p>
                <ul style="color: #666; margin-left: 20px; margin-top: 10px;">
                    <li>Add car models from the "Car Models" section</li>
                    <li>Update your banner settings</li>
                    <li>Manage your personal information</li>
                </ul>
            </div>
        </div>

        <!-- Contacts Section -->
        <div id="contacts" class="content-section">
            <div class="card">
                <h3>Customer Inquiries</h3>
                <p style="color: #666; margin-bottom: 20px;">View and manage contact submissions from your website</p>
                
                <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="filterContacts('all')">All (<span id="countAll">0</span>)</button>
                    <button class="btn btn-secondary" onclick="filterContacts('new')">New (<span id="countNew">0</span>)</button>
                    <button class="btn btn-secondary" onclick="filterContacts('contacted')">Contacted (<span id="countContacted">0</span>)</button>
                </div>

                <div id="contactsList">
                    <p style="color: #666; padding: 20px; text-align: center;">Loading contacts from Firebase...</p>
                </div>
            </div>
        </div>

        <!-- Car Models Section -->
        <div id="cars" class="content-section">
            <div class="card">
                <h3 id="carModelFormTitle">Add New Car Model</h3>
                <form id="carModelForm">
                    <div class="dashboard-grid">
                        <div>
                            <div class="form-group">
                                <label for="carName">Car Model Name</label>
                                <input type="text" id="carName" placeholder="e.g., Myvi" required>
                            </div>
                            <div class="form-group">
                                <label for="carPrice">Price (RM)</label>
                                <input type="text" id="carPrice" placeholder="e.g., RM 46,500" required>
                            </div>
                            <div class="form-group">
                                <label for="carImage">Car Image</label>
                                <input type="file" id="carImage" accept="image/*" onchange="previewImage(this, 'carImagePreview')">
                                <div id="carImagePreview" class="image-preview" style="display:none;">
                                    <img src="" alt="Car Preview">
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="form-group">
                                <label>Car Features (Add up to 5)</label>
                                <div id="featuresContainer">
                                    <div class="feature-input-group">
                                        <input type="text" class="feature-input" placeholder="e.g., 1.3L & 1.5L Engine">
                                    </div>
                                    <div class="feature-input-group">
                                        <input type="text" class="feature-input" placeholder="e.g., ASA 3.0 Safety">
                                    </div>
                                    <div class="feature-input-group">
                                        <input type="text" class="feature-input" placeholder="e.g., Best Seller Model">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-secondary" onclick="addFeatureInput()">+ Add Feature</button>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn" id="carModelSubmitBtn">‚ûï Add Car Model</button>
                        <button type="button" class="btn btn-secondary" id="carModelCancelBtn" onclick="resetCarModelForm()" style="display: none;">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="card">
                <h3>Existing Car Models</h3>
                <div class="car-models-list">
                    <div id="carModelsList">
                        <p style="color: #666; padding: 20px; text-align: center;">Loading car models from Firebase...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Banner Settings Section -->
        <div id="banner" class="content-section">
            <div class="card">
                <h3>Hero Banner Settings</h3>
                <form id="bannerForm">
                    <div class="form-group">
                        <label for="bannerTitle">Banner Title</label>
                        <input type="text" id="bannerTitle" placeholder="e.g., Drive Your Dream Perodua Today">
                    </div>
                    <div class="form-group">
                        <label for="bannerSubtitle">Banner Subtitle</label>
                        <textarea id="bannerSubtitle" placeholder="Enter banner description"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="bannerBackgroundImage">Background Image</label>
                        <input type="file" id="bannerBackgroundImage" accept="image/*" onchange="previewBannerBackgroundImage(this)">
                        <p style="color: #666; font-size: 12px; margin-top: 5px;">Or enter image URL:</p>
                        <input type="text" id="bannerBackgroundImageUrl" placeholder="https://example.com/background.jpg" style="margin-top: 5px;" onchange="previewBannerBackgroundImageUrl(this)">
                        <div id="bannerBackgroundImagePreview" class="image-preview" style="display:none; margin-top: 15px;">
                            <img src="" alt="Background Preview" style="max-width: 100%; max-height: 200px; border-radius: 8px; object-fit: cover;">
                        </div>
                    </div>
                    <button type="submit" class="btn">üíæ Save Banner</button>
                </form>
            </div>

            <div class="card">
                <h3>Banner Image Upload</h3>
                <form id="bannerImageForm">
                    <div class="form-group">
                        <label for="bannerImage">Banner Image</label>
                        <input type="file" id="bannerImage" accept="image/*" onchange="previewBannerImage(this)">
                        <p style="color: #666; font-size: 12px; margin-top: 5px;">Or enter image URL:</p>
                        <input type="text" id="bannerImageUrl" placeholder="https://example.com/banner.jpg" style="margin-top: 5px;">
                        <div id="bannerImagePreview" class="image-preview" style="display:none; margin-top: 15px;">
                            <img src="" alt="Banner Preview" style="max-width: 100%; border-radius: 8px;">
                        </div>
                    </div>
                    <button type="submit" class="btn">‚ûï Add Banner Image</button>
                </form>
            </div>

            <div class="card">
                <h3>Banner Images</h3>
                <div id="bannerImagesList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">No banner images uploaded yet. Add your first one above!</p>
                </div>
            </div>
        </div>

        <!-- Personal Info Section -->
        <div id="personal" class="content-section">
            <div class="card">
                <h3>Personal Information</h3>
                <form id="personalInfoForm">
                    <div class="form-group">
                        <label for="consultantName">Consultant Name</label>
                        <input type="text" id="consultantName" placeholder="Enter name">
                    </div>
                    <div class="form-group">
                        <label for="consultantTitle">Title/Position</label>
                        <input type="text" id="consultantTitle" placeholder="Enter title">
                    </div>
                    <div class="form-group">
                        <label for="profileImage">Profile Image</label>
                        <input type="file" id="profileImage" accept="image/*">
                        <p style="color: #666; font-size: 12px; margin-top: 5px;">Or enter image URL:</p>
                        <input type="text" id="profileImageUrl" placeholder="https://example.com/image.jpg" style="margin-top: 5px;">
                    </div>
                    <button type="submit" class="btn">üíæ Save Personal Info</button>
                </form>
            </div>
        </div>

        <!-- Delivered Cars Gallery Section -->
        <div id="gallery" class="content-section">
            <div class="card">
                <h3 id="galleryFormTitle">Upload Delivered Car Images</h3>
                <form id="galleryForm">
                    <div class="form-group">
                        <label for="galleryImages">Car Images (Multiple)</label>
                        <input type="file" id="galleryImages" accept="image/*" multiple>
                        <p style="color: #666; font-size: 12px; margin-top: 5px;">You can select multiple images at once</p>
                        <div id="galleryImagePreviews" style="margin-top: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;"></div>
                    </div>
                    <button type="submit" class="btn" id="gallerySubmitBtn">‚ûï Upload Images</button>
                </form>
            </div>

            <div class="card">
                <h3>Delivered Cars Gallery</h3>
                <div id="galleryList" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                    <p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">Loading gallery from Firebase...</p>
                </div>
            </div>
        </div>


    </div>

    <script>
        // Firebase variables
        let db = null;
        let firebaseInitialized = false;

        // Default Firebase configuration
        const defaultFirebaseConfig = {
            apiKey: "AIzaSyAaeDEqg9Bqiew3LaMX5LWG8AWnoVbaO_c",
            authDomain: "perodua-2bab4.firebaseapp.com",
            projectId: "perodua-2bab4",
            storageBucket: "perodua-2bab4.firebasestorage.app",
            messagingSenderId: "491719396095",
            appId: "1:491719396095:web:fd8549baf741d896f85aca"
        };

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-hidden');
        }

        // Close mobile menu on outside click
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.querySelector('.mobile-menu-toggle');
            
            if (window.innerWidth <= 768) {
                if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                    sidebar.classList.add('mobile-hidden');
                }
            }
        });

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all menu items
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Add active class to clicked menu item
            event.target.classList.add('active');

            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'contacts': 'Customer Contacts',
                'cars': 'Car Models',
                'banner': 'Banner Settings',
                'personal': 'Personal Information',
                'gallery': 'Delivered Cars Gallery'
            };
            document.getElementById('pageTitle').textContent = titles[sectionId];

            // Reload data when navigating to specific sections (always reload from Firestore if connected)
            if (sectionId === 'banner') {
                if (firebaseInitialized) {
                    loadBannerData();
                    loadBannerImagesList();
                } else {
                    loadBannerFromLocalStorage();
                    loadBannerImagesList();
                }
            } else if (sectionId === 'personal') {
                if (firebaseInitialized) {
                    loadPersonalInfoData();
                } else {
                    loadPersonalInfoFromLocalStorage();
                }
            } else if (sectionId === 'gallery') {
                if (firebaseInitialized) {
                    loadGalleryFromFirestore();
                }
            }

            // Close mobile menu on mobile devices
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.add('mobile-hidden');
            }

            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Initialize Firebase
        function initializeFirebase(config) {
            try {
                firebase.initializeApp(config);
                db = firebase.firestore();
                firebaseInitialized = true;
                
                updateFirebaseStatus(true);
                showSuccessMessage('Firebase connected successfully!');
                
                // Load all data from Firestore (this will overwrite any localStorage data)
                loadCarModelsFromFirestore();
                loadContactsFromFirestore();
                loadGalleryFromFirestore();
                loadAdminDataFromFirestore().then(() => {
                    // After loading from Firestore, refresh the current section if it's an admin section
                    const activeSection = document.querySelector('.content-section.active');
                    if (activeSection) {
                        const sectionId = activeSection.id;
                        if (sectionId === 'banner' && firebaseInitialized) {
                            loadBannerData();
                        } else if (sectionId === 'personal' && firebaseInitialized) {
                            loadPersonalInfoData();
                        } else if (sectionId === 'gallery' && firebaseInitialized) {
                            loadGalleryFromFirestore();
                        }
                    }
                });
                updateDashboard();
                
                return true;
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showErrorMessage('Failed to connect to Firebase: ' + error.message);
                updateFirebaseStatus(false);
                return false;
            }
        }

        // Update Firebase status indicators
        function updateFirebaseStatus(connected) {
            const statusBar = document.getElementById('firebaseStatusBar');
            const dashStatus = document.getElementById('dashFirebaseStatus');
            
            if (connected) {
                statusBar.innerHTML = '<span>üü¢</span><span>Connected</span>';
                statusBar.classList.add('connected');
                dashStatus.textContent = '‚úÖ';
            } else {
                statusBar.innerHTML = '<span>üî¥</span><span>Disconnected</span>';
                statusBar.classList.remove('connected');
                dashStatus.textContent = '‚ùå';
            }
        }

        // Update dashboard stats
        async function updateDashboard() {
            if (firebaseInitialized) {
                try {
                    const snapshot = await db.collection('cars').get();
                    document.getElementById('totalCars').textContent = snapshot.size;
                } catch (error) {
                    console.error('Error updating dashboard:', error);
                }
            }
            
            const now = new Date();
            document.getElementById('lastUpdated').textContent = now.toLocaleTimeString();
        }

        // Load Firebase config from localStorage or use default
        function loadFirebaseConfig() {
            let config = null;
            const savedConfig = localStorage.getItem('firebaseConfig');
            
            if (savedConfig) {
                try {
                    config = JSON.parse(savedConfig);
                } catch (error) {
                    console.error('Error parsing saved config:', error);
                    config = defaultFirebaseConfig;
                }
            } else {
                config = defaultFirebaseConfig;
                localStorage.setItem('firebaseConfig', JSON.stringify(config));
            }
            
            // Populate form fields if they exist (they're hidden now)
            const apiKeyEl = document.getElementById('apiKey');
            if (apiKeyEl) {
                apiKeyEl.value = config.apiKey || '';
                document.getElementById('authDomain').value = config.authDomain || '';
                document.getElementById('projectId').value = config.projectId || '';
                document.getElementById('storageBucket').value = config.storageBucket || '';
                document.getElementById('messagingSenderId').value = config.messagingSenderId || '';
                document.getElementById('appId').value = config.appId || '';
            }
            
            // Auto-initialize if config exists
            if (config.apiKey && config.projectId) {
                initializeFirebase(config);
            }
        }

        // Show success message
        function showSuccessMessage(message = 'Changes saved successfully!') {
            const div = document.getElementById('successMessage');
            div.textContent = message;
            div.style.display = 'block';
            setTimeout(() => {
                div.style.display = 'none';
            }, 3000);
        }

        // Show error message
        function showErrorMessage(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        // Custom Confirm Modal
        function showCustomConfirm(message, title = 'Confirm Action', icon = '‚ö†Ô∏è') {
            return new Promise((resolve) => {
                const overlay = document.getElementById('customModalOverlay');
                const modalHeader = document.getElementById('customModalHeader');
                const modalIcon = document.getElementById('customModalIcon');
                const modalTitle = document.getElementById('customModalTitle');
                const modalBody = document.getElementById('customModalBody');
                const modalFooter = document.getElementById('customModalFooter');
                const cancelBtn = document.getElementById('customModalCancel');
                const confirmBtn = document.getElementById('customModalConfirm');

                // Set content
                modalIcon.textContent = icon;
                modalTitle.textContent = title;
                modalBody.innerHTML = message.replace(/\n/g, '<br>');
                modalHeader.className = 'custom-modal-header warning';

                // Show modal
                overlay.classList.add('show');

                // Handle cancel
                const handleCancel = () => {
                    overlay.classList.remove('show');
                    cancelBtn.removeEventListener('click', handleCancel);
                    confirmBtn.removeEventListener('click', handleConfirm);
                    overlay.removeEventListener('click', handleOverlayClick);
                    resolve(false);
                };

                // Handle confirm
                const handleConfirm = () => {
                    overlay.classList.remove('show');
                    cancelBtn.removeEventListener('click', handleCancel);
                    confirmBtn.removeEventListener('click', handleConfirm);
                    overlay.removeEventListener('click', handleOverlayClick);
                    resolve(true);
                };

                // Handle overlay click (close on outside click)
                const handleOverlayClick = (e) => {
                    if (e.target === overlay) {
                        handleCancel();
                    }
                };

                cancelBtn.addEventListener('click', handleCancel);
                confirmBtn.addEventListener('click', handleConfirm);
                overlay.addEventListener('click', handleOverlayClick);
            });
        }

        // Custom Alert Modal
        function showCustomAlert(message, title = 'Alert', icon = '‚ÑπÔ∏è', type = 'info') {
            return new Promise((resolve) => {
                const overlay = document.getElementById('customModalOverlay');
                const modalHeader = document.getElementById('customModalHeader');
                const modalIcon = document.getElementById('customModalIcon');
                const modalTitle = document.getElementById('customModalTitle');
                const modalBody = document.getElementById('customModalBody');
                const modalFooter = document.getElementById('customModalFooter');
                const cancelBtn = document.getElementById('customModalCancel');
                const confirmBtn = document.getElementById('customModalConfirm');

                // Set content
                modalIcon.textContent = icon;
                modalTitle.textContent = title;
                modalBody.innerHTML = message.replace(/\n/g, '<br>');
                
                // Set header style based on type
                modalHeader.className = `custom-modal-header ${type}`;
                
                // Hide cancel button, show only OK button
                cancelBtn.style.display = 'none';
                confirmBtn.textContent = 'OK';
                confirmBtn.className = 'custom-modal-btn custom-modal-btn-ok';

                // Show modal
                overlay.classList.add('show');

                // Handle OK
                const handleOK = () => {
                    overlay.classList.remove('show');
                    confirmBtn.removeEventListener('click', handleOK);
                    overlay.removeEventListener('click', handleOverlayClick);
                    cancelBtn.style.display = 'block';
                    confirmBtn.textContent = 'Confirm';
                    confirmBtn.className = 'custom-modal-btn custom-modal-btn-confirm';
                    resolve(true);
                };

                // Handle overlay click
                const handleOverlayClick = (e) => {
                    if (e.target === overlay) {
                        handleOK();
                    }
                };

                confirmBtn.addEventListener('click', handleOK);
                overlay.addEventListener('click', handleOverlayClick);
            });
        }

        // Preview image function with file size validation
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const img = preview.querySelector('img');
            
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Check file size (5MB limit)
                const maxSize = 5 * 1024 * 1024; // 5MB in bytes
                if (file.size > maxSize) {
                    showErrorMessage('Image size must be less than 5MB. Please choose a smaller image.');
                    input.value = ''; // Clear the file input
                    preview.style.display = 'none';
                    return;
                }
                
                // Check if it's an image
                if (!file.type.startsWith('image/')) {
                    showErrorMessage('Please select a valid image file.');
                    input.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    img.src = e.target.result;
                    preview.style.display = 'block';
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Add feature input
        function addFeatureInput() {
            const container = document.getElementById('featuresContainer');
            const featureCount = container.querySelectorAll('.feature-input-group').length;
            
            if (featureCount < 5) {
                const div = document.createElement('div');
                div.className = 'feature-input-group';
                div.innerHTML = '<input type="text" class="feature-input" placeholder="Enter feature">';
                container.appendChild(div);
            } else {
                showCustomAlert('You can add a maximum of 5 features per car model.', 'Maximum Features Reached', '‚ÑπÔ∏è', 'info');
            }
        }

        // Banner form submission
        document.getElementById('bannerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const title = document.getElementById('bannerTitle').value.trim();
            const subtitle = document.getElementById('bannerSubtitle').value.trim();
            const backgroundImageInput = document.getElementById('bannerBackgroundImage');
            const backgroundImageUrl = document.getElementById('bannerBackgroundImageUrl').value.trim();
            
            if (!title && !subtitle) {
                showErrorMessage('Please enter at least a title or subtitle');
                return;
            }
            
            // Handle background image
            let backgroundImageSrc = '';
            
            // Check if there's an existing background image stored (don't overwrite if no new image provided)
            const existingBannerData = JSON.parse(localStorage.getItem('bannerData') || '{}');
            const existingBackgroundImage = existingBannerData.backgroundImage || '';
            
            if (backgroundImageInput.files && backgroundImageInput.files[0]) {
                // New file uploaded - convert to base64
                const file = backgroundImageInput.files[0];
                
                // Check file size (5MB limit)
                const maxSize = 5 * 1024 * 1024; // 5MB in bytes
                if (file.size > maxSize) {
                    showErrorMessage('Image size must be less than 5MB. Please choose a smaller image.');
                    return;
                }
                
                // Check if it's an image
                if (!file.type.startsWith('image/')) {
                    showErrorMessage('Please select a valid image file.');
                    return;
                }
                
                const reader = new FileReader();
                
                await new Promise((resolve, reject) => {
                    reader.onload = function(e) {
                        backgroundImageSrc = e.target.result;
                        resolve();
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            } else if (backgroundImageUrl) {
                // URL provided - use the URL
                backgroundImageSrc = backgroundImageUrl;
            } else {
                // No new image provided, keep existing one if available
                backgroundImageSrc = existingBackgroundImage;
            }
            
            const data = {
                title: title,
                subtitle: subtitle,
                backgroundImage: backgroundImageSrc,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (firebaseInitialized) {
                    await db.collection('admin').doc('banner').set(data, { merge: true });
                    console.log('Banner Data saved to Firestore:', data);
                    showSuccessMessage('‚úÖ Banner settings saved successfully!');
                } else {
                    showErrorMessage('Firebase not connected. Please connect to Firebase first.');
                }
                
                // Also save to localStorage as backup
                localStorage.setItem('bannerData', JSON.stringify({ title: title, subtitle: subtitle, backgroundImage: backgroundImageSrc }));
                updateDashboard();
            } catch (error) {
                console.error('Error saving banner:', error);
                showErrorMessage('Failed to save banner: ' + error.message);
                
                // Save to localStorage as fallback
                localStorage.setItem('bannerData', JSON.stringify({ title: title, subtitle: subtitle, backgroundImage: backgroundImageSrc }));
                showSuccessMessage('Banner saved to local storage only');
            }
        });

        // Preview banner image before upload
        function previewBannerImage(input) {
            const preview = document.getElementById('bannerImagePreview');
            const img = preview.querySelector('img');
            
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Check file size (5MB limit)
                const maxSize = 5 * 1024 * 1024; // 5MB in bytes
                if (file.size > maxSize) {
                    showErrorMessage('Image size must be less than 5MB. Please choose a smaller image.');
                    input.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                // Check if it's an image
                if (!file.type.startsWith('image/')) {
                    showErrorMessage('Please select a valid image file.');
                    input.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    img.src = e.target.result;
                    preview.style.display = 'block';
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Preview banner background image before upload
        function previewBannerBackgroundImage(input) {
            const preview = document.getElementById('bannerBackgroundImagePreview');
            const img = preview.querySelector('img');
            
            if (input.files && input.files[0]) {
                const file = input.files[0];
                
                // Check file size (5MB limit)
                const maxSize = 5 * 1024 * 1024; // 5MB in bytes
                if (file.size > maxSize) {
                    showErrorMessage('Image size must be less than 5MB. Please choose a smaller image.');
                    input.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                // Check if it's an image
                if (!file.type.startsWith('image/')) {
                    showErrorMessage('Please select a valid image file.');
                    input.value = '';
                    preview.style.display = 'none';
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    img.src = e.target.result;
                    preview.style.display = 'block';
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Preview banner background image from URL
        function previewBannerBackgroundImageUrl(input) {
            const preview = document.getElementById('bannerBackgroundImagePreview');
            const img = preview.querySelector('img');
            const url = input.value.trim();
            
            if (url) {
                // Validate URL
                if (url.startsWith('http://') || url.startsWith('https://') || url.startsWith('data:image/')) {
                    img.src = url;
                    preview.style.display = 'block';
                } else {
                    showErrorMessage('Please enter a valid image URL (must start with http:// or https://)');
                    preview.style.display = 'none';
                }
            } else {
                preview.style.display = 'none';
            }
        }

        // Banner image form submission
        document.getElementById('bannerImageForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const bannerImageInput = document.getElementById('bannerImage');
            const bannerImageUrl = document.getElementById('bannerImageUrl').value.trim();
            
            // Determine which image source to use
            let bannerImageSrc = '';
            
            if (bannerImageInput.files && bannerImageInput.files[0]) {
                // New file uploaded - convert to base64
                const file = bannerImageInput.files[0];
                
                // Check file size (5MB limit)
                const maxSize = 5 * 1024 * 1024; // 5MB in bytes
                if (file.size > maxSize) {
                    showErrorMessage('Image size must be less than 5MB. Please choose a smaller image.');
                    return;
                }
                
                // Check if it's an image
                if (!file.type.startsWith('image/')) {
                    showErrorMessage('Please select a valid image file.');
                    return;
                }
                
                const reader = new FileReader();
                
                await new Promise((resolve, reject) => {
                    reader.onload = function(e) {
                        bannerImageSrc = e.target.result;
                        resolve();
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            } else if (bannerImageUrl) {
                // URL provided - use the URL
                bannerImageSrc = bannerImageUrl;
            } else {
                showErrorMessage('Please select an image file or enter an image URL');
                return;
            }
            
            try {
                if (firebaseInitialized) {
                    // Load existing images array
                    const bannerImageDoc = await db.collection('admin').doc('bannerImage').get();
                    let images = [];
                    
                    if (bannerImageDoc.exists && bannerImageDoc.data().images) {
                        images = bannerImageDoc.data().images;
                    }
                    
                    // Add new image to array
                    images.push(bannerImageSrc);
                    
                    // Save updated array
                    const data = {
                        images: images,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('admin').doc('bannerImage').set(data, { merge: true });
                    console.log('Banner Image added to Firestore:', data);
                    showSuccessMessage('‚úÖ Banner image added successfully!');
                    
                    // Reload banner images list
                    loadBannerImagesList();
                } else {
                    showErrorMessage('Firebase not connected. Please connect to Firebase first.');
                }
                
                // Also save to localStorage as backup
                const localImages = JSON.parse(localStorage.getItem('bannerImages') || '[]');
                localImages.push(bannerImageSrc);
                localStorage.setItem('bannerImages', JSON.stringify(localImages));
                
                // Reset form
                document.getElementById('bannerImageForm').reset();
                document.getElementById('bannerImagePreview').style.display = 'none';
                updateDashboard();
            } catch (error) {
                console.error('Error saving banner image:', error);
                showErrorMessage('Failed to save banner image: ' + error.message);
                
                // Save to localStorage as fallback
                const localImages = JSON.parse(localStorage.getItem('bannerImages') || '[]');
                localImages.push(bannerImageSrc);
                localStorage.setItem('bannerImages', JSON.stringify(localImages));
                showSuccessMessage('Banner image saved to local storage only');
                
                // Reset form
                document.getElementById('bannerImageForm').reset();
                document.getElementById('bannerImagePreview').style.display = 'none';
            }
        });

        // Remove banner image
        window.removeBannerImage = async function(imageIndex) {
            const confirmed = await showCustomConfirm(
                'Are you sure you want to delete this banner image?<br><br><strong>This action cannot be undone.</strong>',
                'Delete Banner Image',
                'üóëÔ∏è'
            );
            
            if (!confirmed) {
                return;
            }

            if (!firebaseInitialized) {
                showErrorMessage('Firebase not connected');
                return;
            }

            try {
                // Load existing images array
                const bannerImageDoc = await db.collection('admin').doc('bannerImage').get();
                let images = [];
                
                if (bannerImageDoc.exists && bannerImageDoc.data().images) {
                    images = bannerImageDoc.data().images;
                }
                
                // Remove image at index
                images.splice(imageIndex, 1);
                
                // Save updated array
                const data = {
                    images: images,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('admin').doc('bannerImage').set(data, { merge: true });
                showSuccessMessage('‚úÖ Banner image deleted successfully!');
                
                // Reload banner images list
                loadBannerImagesList();
            } catch (error) {
                console.error('Error removing banner image:', error);
                showErrorMessage('Failed to delete banner image: ' + error.message);
            }
        };

        // Load and display banner images list
        async function loadBannerImagesList() {
            const list = document.getElementById('bannerImagesList');
            
            if (!firebaseInitialized) {
                // Load from localStorage
                const localImages = JSON.parse(localStorage.getItem('bannerImages') || '[]');
                if (localImages.length === 0) {
                    list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">No banner images uploaded yet. Add your first one above!</p>';
                } else {
                    list.innerHTML = '';
                    localImages.forEach((img, index) => {
                        addBannerImageToList(img, index);
                    });
                }
                return;
            }

            try {
                const bannerImageDoc = await db.collection('admin').doc('bannerImage').get();
                
                if (!bannerImageDoc.exists || !bannerImageDoc.data().images || bannerImageDoc.data().images.length === 0) {
                    list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">No banner images uploaded yet. Add your first one above!</p>';
                    return;
                }
                
                const images = bannerImageDoc.data().images;
                list.innerHTML = '';
                
                images.forEach((img, index) => {
                    addBannerImageToList(img, index);
                });
            } catch (error) {
                console.error('Error loading banner images:', error);
                list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">Error loading banner images</p>';
            }
        }

        // Add banner image to list display
        function addBannerImageToList(imgSrc, index) {
            const list = document.getElementById('bannerImagesList');
            const div = document.createElement('div');
            div.style.position = 'relative';
            div.style.border = '2px solid #e0e0e0';
            div.style.borderRadius = '8px';
            div.style.overflow = 'hidden';
            div.style.background = '#f8f9fa';
            
            // Escape the image source for onclick
            const escapedImg = imgSrc.replace(/'/g, "\\'");
            div.innerHTML = `
                <img src="${imgSrc}" alt="Banner Image" style="width: 100%; height: 200px; object-fit: cover; cursor: pointer;" onclick="viewFullImage('${escapedImg}')">
                <div style="padding: 10px; display: flex; gap: 10px;">
                    <button class="btn btn-remove" onclick="event.stopPropagation(); removeBannerImage(${index})" style="flex: 1; font-size: 13px; padding: 8px 15px;">üóëÔ∏è Remove</button>
                </div>
            `;
            list.appendChild(div);
        }

        // Personal info form submission
        document.getElementById('personalInfoForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const consultantName = document.getElementById('consultantName').value.trim();
            const consultantTitle = document.getElementById('consultantTitle').value.trim();
            const profileImageInput = document.getElementById('profileImage');
            const profileImageUrl = document.getElementById('profileImageUrl').value.trim();
            
            // Determine which image source to use
            let profileImageSrc = '';
            
            if (profileImageInput.files && profileImageInput.files[0]) {
                // New file uploaded - convert to base64
                const file = profileImageInput.files[0];
                const reader = new FileReader();
                
                await new Promise((resolve, reject) => {
                    reader.onload = function(e) {
                        profileImageSrc = e.target.result;
                        resolve();
                    };
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            } else if (profileImageUrl) {
                // URL provided - use the URL
                profileImageSrc = profileImageUrl;
            }
            
            if (!consultantName && !consultantTitle) {
                showErrorMessage('Please enter at least a name or title');
                return;
            }
            
            try {
                const data = {
                    name: consultantName,
                    title: consultantTitle,
                    image: profileImageSrc, // Can be URL or base64
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                if (firebaseInitialized) {
                    await db.collection('admin').doc('personalInfo').set(data, { merge: true });
                    console.log('Personal Info saved to Firestore:', data);
                    showSuccessMessage('‚úÖ Personal information saved successfully!');
                } else {
                    showErrorMessage('Firebase not connected. Please connect to Firebase first.');
                }
                
                // Also save to localStorage as backup
                localStorage.setItem('personalInfo', JSON.stringify({ 
                    name: consultantName, 
                    title: consultantTitle, 
                    image: profileImageSrc 
                }));
                updateDashboard();
            } catch (error) {
                console.error('Error saving personal info:', error);
                showErrorMessage('Failed to save personal info: ' + error.message);
                
                // Save to localStorage as fallback
                localStorage.setItem('personalInfo', JSON.stringify({ 
                    name: consultantName, 
                    title: consultantTitle, 
                    image: profileImageSrc 
                }));
                showSuccessMessage('Personal info saved to local storage only');
            }
        });

        // Gallery variables
        let galleryUnsubscribe = null;

        // Preview multiple gallery images
        document.getElementById('galleryImages').addEventListener('change', function(e) {
            const previewsContainer = document.getElementById('galleryImagePreviews');
            previewsContainer.innerHTML = '';
            
            if (e.target.files && e.target.files.length > 0) {
                Array.from(e.target.files).forEach((file, index) => {
                    // Check file size (5MB limit)
                    const maxSize = 5 * 1024 * 1024;
                    if (file.size > maxSize) {
                        showErrorMessage(`Image ${index + 1} is too large. Maximum size is 5MB.`);
                        return;
                    }
                    
                    if (!file.type.startsWith('image/')) {
                        showErrorMessage(`File ${index + 1} is not a valid image.`);
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const div = document.createElement('div');
                        div.style.position = 'relative';
                        div.innerHTML = `
                            <img src="${event.target.result}" style="width: 100%; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #e0e0e0;">
                            <button type="button" onclick="removeGalleryPreview(this)" style="position: absolute; top: 5px; right: 5px; background: #f44336; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 14px;">√ó</button>
                        `;
                        div.setAttribute('data-file-index', index);
                        previewsContainer.appendChild(div);
                    };
                    reader.readAsDataURL(file);
                });
            }
        });

        // Remove gallery preview
        function removeGalleryPreview(button) {
            const previewDiv = button.parentElement;
            const fileIndex = parseInt(previewDiv.getAttribute('data-file-index'));
            const input = document.getElementById('galleryImages');
            const dt = new DataTransfer();
            
            // Rebuild file list without the removed file
            Array.from(input.files).forEach((file, index) => {
                if (index !== fileIndex) {
                    dt.items.add(file);
                }
            });
            
            input.files = dt.files;
            previewDiv.remove();
            
            // Trigger change event to update previews
            const event = new Event('change', { bubbles: true });
            input.dispatchEvent(event);
        }

        // Gallery form submission
        document.getElementById('galleryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!firebaseInitialized) {
                showErrorMessage('Please connect to Firebase first!');
                return;
            }
            
            const imageInput = document.getElementById('galleryImages');
            
            if (!imageInput.files || imageInput.files.length === 0) {
                showErrorMessage('Please select at least one image');
                return;
            }
            
            try {
                // Convert all images to base64
                const images = [];
                for (let i = 0; i < imageInput.files.length; i++) {
                    const file = imageInput.files[i];
                    const reader = new FileReader();
                    
                    await new Promise((resolve, reject) => {
                        reader.onload = function(e) {
                            images.push(e.target.result);
                            resolve();
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(file);
                    });
                }
                
                // Create new gallery item - each upload creates a new document
                const galleryItem = {
                    images: images,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('gallery').add(galleryItem);
                showSuccessMessage(`‚úÖ ${images.length} image(s) uploaded successfully!`);
                
                resetGalleryForm();
                updateDashboard();
            } catch (error) {
                console.error('Error saving gallery item:', error);
                showErrorMessage('Failed to save images: ' + error.message);
            }
        });

        // Reset gallery form
        function resetGalleryForm() {
            document.getElementById('galleryForm').reset();
            document.getElementById('galleryImagePreviews').innerHTML = '';
        }

        // Load gallery from Firestore
        function loadGalleryFromFirestore() {
            if (!firebaseInitialized) {
                const list = document.getElementById('galleryList');
                list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">Connect to Firebase to view gallery</p>';
                return;
            }

            try {
                const list = document.getElementById('galleryList');
                
                if (galleryUnsubscribe) {
                    galleryUnsubscribe();
                }
                
                galleryUnsubscribe = db.collection('gallery')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        list.innerHTML = '';
                        
                        if (snapshot.empty) {
                            list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">No delivered cars in gallery yet. Add your first one above!</p>';
                            return;
                        }

                        snapshot.forEach(doc => {
                            const item = doc.data();
                            addGalleryItemToList(item, doc.id);
                        });
                    }, (error) => {
                        console.error('Error loading gallery:', error);
                        showErrorMessage('Failed to load gallery: ' + error.message);
                        list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center; grid-column: 1 / -1;">Error loading gallery</p>';
                    });
            } catch (error) {
                console.error('Error setting up gallery listener:', error);
                showErrorMessage('Failed to load gallery: ' + error.message);
            }
        }

        // Add gallery item to list
        function addGalleryItemToList(item, docId) {
            const list = document.getElementById('galleryList');
            
            // Display each image individually in the gallery
            if (item.images && item.images.length > 0) {
                item.images.forEach((img, idx) => {
                    const div = document.createElement('div');
                    div.style.position = 'relative';
                    div.className = 'car-model-item';
                    div.setAttribute('data-gallery-id', docId);
                    div.setAttribute('data-image-index', idx);
                    
                    // Escape the image source for onclick
                    const escapedImg = img.replace(/'/g, "\\'");
                    div.innerHTML = `
                        <img src="${img}" alt="Gallery Image" style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px; cursor: pointer;" onclick="viewFullImage('${escapedImg}')">
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button class="btn btn-remove" onclick="event.stopPropagation(); removeGalleryImage('${docId}', ${idx})" style="flex: 1;">üóëÔ∏è Remove</button>
                        </div>
                    `;
                    list.appendChild(div);
                });
            }
        }
        
        // View full image
        function viewFullImage(imgSrc) {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = `
                <img src="${imgSrc}" style="max-width: 90%; max-height: 90%; object-fit: contain;">
                <button onclick="this.parentElement.remove()" style="position: absolute; top: 20px; right: 20px; background: #f44336; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 18px;">‚úï Close</button>
            `;
            document.body.appendChild(modal);
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }
        
        // Remove single image from gallery
        window.removeGalleryImage = async function(docId, imageIndex) {
            // Show custom confirmation dialog
            const confirmed = await showCustomConfirm(
                'Are you sure you want to delete this image?<br><br><strong>This action cannot be undone.</strong>',
                'Delete Image',
                'üóëÔ∏è'
            );
            
            if (!confirmed) {
                return;
            }

            if (!firebaseInitialized) {
                showErrorMessage('Firebase not connected');
                return;
            }

            try {
                const doc = await db.collection('gallery').doc(docId).get();
                const item = doc.data();
                
                if (!item) {
                    showErrorMessage('Gallery item not found');
                    return;
                }

                const images = item.images || [];
                
                // Remove the image at the specified index
                images.splice(imageIndex, 1);
                
                if (images.length === 0) {
                    // If no images left, delete the entire document
                    await db.collection('gallery').doc(docId).delete();
                    showSuccessMessage('‚úÖ Image deleted successfully!');
                } else {
                    // Update with remaining images
                    await db.collection('gallery').doc(docId).update({ images: images });
                    showSuccessMessage('‚úÖ Image deleted successfully!');
                }
            } catch (error) {
                console.error('Error removing image:', error);
                showErrorMessage('Failed to delete image: ' + error.message);
            }
        }



        // Car model form submission
        document.getElementById('carModelForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!firebaseInitialized) {
                showErrorMessage('Please connect to Firebase first!');
                return;
            }
            
            const carName = document.getElementById('carName').value;
            const carPrice = document.getElementById('carPrice').value;
            const carImageInput = document.getElementById('carImage');
            const carImagePreview = document.querySelector('#carImagePreview img');
            
            // Use preview image if available (either new upload or existing image)
            let carImageSrc = '';
            if (carImagePreview && carImagePreview.src) {
                carImageSrc = carImagePreview.src;
            }
            
            const features = [];
            document.querySelectorAll('.feature-input').forEach(input => {
                if (input.value.trim()) {
                    features.push(input.value.trim());
                }
            });

            try {
                const carModel = {
                    name: carName,
                    price: carPrice,
                    features: features,
                    image: carImageSrc, // Store base64 directly
                };

                if (editingCarModelId) {
                    // Update existing car model
                    await db.collection('cars').doc(editingCarModelId).update(carModel);
                    showSuccessMessage(`‚úÖ Car model "${carName}" updated successfully!`);
                    console.log('Car Model Updated in Firestore:', carModel);
                } else {
                    // Add new car model
                    carModel.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('cars').add(carModel);
                    showSuccessMessage(`‚úÖ Car model "${carName}" added successfully!`);
                    console.log('Car Model Added to Firestore:', carModel);
                }
                
                // Reset form after successful save
                resetCarModelForm();
                updateDashboard();
            } catch (error) {
                console.error('Error saving car model:', error);
                showErrorMessage('Failed to save car model: ' + error.message);
            }
        });

        // Reset car model form
        function resetCarModelForm() {
            document.getElementById('carModelForm').reset();
            document.getElementById('carImagePreview').style.display = 'none';
            editingCarModelId = null;
            
            // Update button text and title
            const submitButton = document.getElementById('carModelSubmitBtn');
            const cancelButton = document.getElementById('carModelCancelBtn');
            const formTitle = document.getElementById('carModelFormTitle');
            
            submitButton.textContent = '‚ûï Add Car Model';
            formTitle.textContent = 'Add New Car Model';
            cancelButton.style.display = 'none';
            
            // Reset file input
            document.getElementById('carImage').value = '';
            
            // Reset features to 3 inputs
            const container = document.getElementById('featuresContainer');
            container.innerHTML = `
                <div class="feature-input-group">
                    <input type="text" class="feature-input" placeholder="e.g., 1.3L & 1.5L Engine">
                </div>
                <div class="feature-input-group">
                    <input type="text" class="feature-input" placeholder="e.g., ASA 3.0 Safety">
                </div>
                <div class="feature-input-group">
                    <input type="text" class="feature-input" placeholder="e.g., Best Seller Model">
                </div>
            `;
        }

        // Edit car model
        async function editCarModel(button, docId) {
            if (!docId) {
                showErrorMessage('Cannot edit: Document ID not found');
                return;
            }

            if (!firebaseInitialized) {
                showErrorMessage('Please connect to Firebase first!');
                return;
            }

            try {
                // Get car model data from Firestore
                const doc = await db.collection('cars').doc(docId).get();
                if (!doc.exists) {
                    showErrorMessage('Car model not found');
                    return;
                }

                const carModel = doc.data();
                editingCarModelId = docId;

                // Populate form fields
                document.getElementById('carName').value = carModel.name || '';
                document.getElementById('carPrice').value = carModel.price || '';

                // Populate features
                const container = document.getElementById('featuresContainer');
                container.innerHTML = '';
                if (carModel.features && carModel.features.length > 0) {
                    carModel.features.forEach(feature => {
                        const div = document.createElement('div');
                        div.className = 'feature-input-group';
                        div.innerHTML = `<input type="text" class="feature-input" placeholder="Enter feature" value="${feature}">`;
                        container.appendChild(div);
                    });
                } else {
                    // Add 3 empty feature inputs
                    for (let i = 0; i < 3; i++) {
                        const div = document.createElement('div');
                        div.className = 'feature-input-group';
                        div.innerHTML = `<input type="text" class="feature-input" placeholder="Enter feature">`;
                        container.appendChild(div);
                    }
                }

                // Show existing image if available
                if (carModel.image) {
                    const preview = document.getElementById('carImagePreview');
                    const img = preview.querySelector('img');
                    img.src = carModel.image;
                    preview.style.display = 'block';
                } else {
                    document.getElementById('carImagePreview').style.display = 'none';
                }

                // Update button text, title, and show cancel button
                const submitButton = document.getElementById('carModelSubmitBtn');
                const cancelButton = document.getElementById('carModelCancelBtn');
                const formTitle = document.getElementById('carModelFormTitle');
                
                submitButton.textContent = 'üíæ Update Car Model';
                formTitle.textContent = 'Edit Car Model';
                cancelButton.style.display = 'inline-block';

                // Scroll to form
                document.getElementById('carModelForm').scrollIntoView({ behavior: 'smooth', block: 'start' });

                showSuccessMessage('Car model loaded for editing');
            } catch (error) {
                console.error('Error loading car model for editing:', error);
                showErrorMessage('Failed to load car model: ' + error.message);
            }
        }

        // Add car model to list
        function addCarModelToList(carModel, docId = null) {
            const list = document.getElementById('carModelsList');
            const div = document.createElement('div');
            div.className = 'car-model-item';
            if (docId) {
                div.setAttribute('data-doc-id', docId);
            }
            div.innerHTML = `
                <h4>${carModel.name}</h4>
                <p><strong>Price:</strong> ${carModel.price}</p>
                <p><strong>Features:</strong> ${carModel.features ? carModel.features.join(', ') : 'No features'}</p>
                ${carModel.image ? `<img src="${carModel.image}" alt="${carModel.name}">` : ''}
                <div style="margin-top: 10px; display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="editCarModel(this, '${docId || ''}')">‚úèÔ∏è Edit</button>
                    <button class="btn btn-remove" onclick="removeCarModel(this)">üóëÔ∏è Remove</button>
                </div>
            `;
            list.appendChild(div);
        }

        // Real-time listener for car models
        let carModelsUnsubscribe = null;
        let editingCarModelId = null; // Track which car model is being edited

        // Load car models from Firestore with real-time updates
        function loadCarModelsFromFirestore() {
            if (!firebaseInitialized) {
                const carModels = JSON.parse(localStorage.getItem('carModels') || '[]');
                const list = document.getElementById('carModelsList');
                list.innerHTML = '';
                if (carModels.length === 0) {
                    list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center;">No car models found. Add your first car model above!</p>';
                } else {
                    carModels.forEach(car => {
                        addCarModelToList(car);
                    });
                }
                return;
            }

            try {
                const list = document.getElementById('carModelsList');
                
                if (carModelsUnsubscribe) {
                    carModelsUnsubscribe();
                }
                
                carModelsUnsubscribe = db.collection('cars')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        list.innerHTML = '';
                        
                        if (snapshot.empty) {
                            list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center;">No car models found. Add your first car model above!</p>';
                            return;
                        }

                        snapshot.forEach(doc => {
                            const carModel = doc.data();
                            addCarModelToList(carModel, doc.id);
                        });
                        
                        updateDashboard();
                    }, (error) => {
                        console.error('Error loading car models:', error);
                        showErrorMessage('Failed to load car models: ' + error.message);
                        
                        const carModels = JSON.parse(localStorage.getItem('carModels') || '[]');
                        list.innerHTML = '';
                        if (carModels.length === 0) {
                            list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center;">No car models found. Add your first car model above!</p>';
                        } else {
                            carModels.forEach(car => {
                                addCarModelToList(car);
                            });
                        }
                    });
            } catch (error) {
                console.error('Error setting up car models listener:', error);
                showErrorMessage('Failed to load car models: ' + error.message);
            }
        }

        // Remove car model
        async function removeCarModel(button) {
            const item = button.parentElement;
            const carName = item.querySelector('h4').textContent;
            
            const confirmed = await showCustomConfirm(
                `Are you sure you want to delete "<strong>${carName}</strong>"?<br><br><strong>This action cannot be undone.</strong>`,
                'Delete Car Model',
                'üóëÔ∏è'
            );
            
            if (!confirmed) {
                return;
            }

            const docId = item.getAttribute('data-doc-id');
            
            if (firebaseInitialized && docId) {
                try {
                    await db.collection('cars').doc(docId).delete();
                    item.remove();
                    showSuccessMessage(`‚úÖ Car model "${carName}" deleted successfully!`);
                    updateDashboard();
                } catch (error) {
                    console.error('Error removing car model:', error);
                    showErrorMessage('Failed to delete car model: ' + error.message);
                }
            } else {
                let carModels = JSON.parse(localStorage.getItem('carModels') || '[]');
                carModels = carModels.filter(car => car.name !== carName);
                localStorage.setItem('carModels', JSON.stringify(carModels));
                item.remove();
                showSuccessMessage(`‚úÖ Car model "${carName}" deleted successfully!`);
            }
        }

        // Contacts Management
        let contactsUnsubscribe = null;
        let allContacts = [];
        let currentFilter = 'all';

        // Load contacts from Firestore with real-time updates
        function loadContactsFromFirestore() {
            if (!firebaseInitialized) {
                const list = document.getElementById('contactsList');
                list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center;">Connect to Firebase to view contacts</p>';
                return;
            }

            try {
                if (contactsUnsubscribe) {
                    contactsUnsubscribe();
                }
                
                contactsUnsubscribe = db.collection('contacts')
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        allContacts = [];
                        
                        if (snapshot.empty) {
                            document.getElementById('contactsList').innerHTML = '<p style="color: #666; padding: 20px; text-align: center;">No customer inquiries yet.</p>';
                            updateContactCounts(0, 0, 0);
                            return;
                        }

                        snapshot.forEach(doc => {
                            const contact = doc.data();
                            contact.id = doc.id;
                            allContacts.push(contact);
                        });
                        
                        displayContacts(currentFilter);
                        updateContactCounts();
                    }, (error) => {
                        console.error('Error loading contacts:', error);
                        showErrorMessage('Failed to load contacts: ' + error.message);
                    });
            } catch (error) {
                console.error('Error setting up contacts listener:', error);
                showErrorMessage('Failed to load contacts: ' + error.message);
            }
        }

        // Display contacts based on filter
        function displayContacts(filter) {
            currentFilter = filter;
            const list = document.getElementById('contactsList');
            list.innerHTML = '';
            
            let filteredContacts = allContacts;
            if (filter === 'new') {
                filteredContacts = allContacts.filter(c => c.status === 'new');
            } else if (filter === 'contacted') {
                filteredContacts = allContacts.filter(c => c.status === 'contacted');
            }
            
            if (filteredContacts.length === 0) {
                list.innerHTML = '<p style="color: #666; padding: 20px; text-align: center;">No contacts found.</p>';
                return;
            }
            
            filteredContacts.forEach(contact => {
                addContactToList(contact);
            });
        }

        // Add contact to list
        function addContactToList(contact) {
            const list = document.getElementById('contactsList');
            const div = document.createElement('div');
            div.className = `contact-item ${contact.status || 'new'}`;
            div.setAttribute('data-contact-id', contact.id);
            
            const timestamp = contact.timestamp ? new Date(contact.timestamp).toLocaleString() : 'N/A';
            
            div.innerHTML = `
                <div class="contact-header">
                    <div>
                        <div class="contact-name">${contact.name || 'No Name'}</div>
                    </div>
                    <span class="contact-status ${contact.status || 'new'}">${contact.status === 'contacted' ? 'Contacted' : 'New'}</span>
                </div>
                <div class="contact-details">
                    <div class="contact-detail">
                        <span>üìß</span>
                        <span>${contact.email || 'No email'}</span>
                    </div>
                    <div class="contact-detail">
                        <span>üì±</span>
                        <span>${contact.phone || 'No phone'}</span>
                    </div>
                    <div class="contact-detail">
                        <span>üöô</span>
                        <span>Interested in: ${contact.interestedModel || 'Not specified'}</span>
                    </div>
                </div>
                <div class="contact-message">
                    <strong>Message:</strong>
                    <p>${contact.message || 'No message'}</p>
                </div>
                <div class="contact-actions">
                    ${contact.status !== 'contacted' ? 
                        `<button class="btn btn-secondary" onclick="markAsContacted('${contact.id}')">‚úì Mark as Contacted</button>` : 
                        `<button class="btn btn-secondary" onclick="markAsNew('${contact.id}')">‚Ü∫ Mark as New</button>`
                    }
                    <button class="btn btn-remove" onclick="deleteContact('${contact.id}')">üóëÔ∏è Delete</button>
                </div>
                <div class="contact-timestamp">Received: ${timestamp}</div>
            `;
            list.appendChild(div);
        }

        // Update contact counts
        function updateContactCounts() {
            const total = allContacts.length;
            const newCount = allContacts.filter(c => c.status === 'new').length;
            const contactedCount = allContacts.filter(c => c.status === 'contacted').length;
            
            document.getElementById('countAll').textContent = total;
            document.getElementById('countNew').textContent = newCount;
            document.getElementById('countContacted').textContent = contactedCount;
        }

        // Filter contacts
        function filterContacts(filter) {
            displayContacts(filter);
        }

        // Mark as contacted
        async function markAsContacted(contactId) {
            if (!firebaseInitialized) {
                showErrorMessage('Firebase not connected');
                return;
            }

            try {
                await db.collection('contacts').doc(contactId).update({
                    status: 'contacted',
                    contactedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                showSuccessMessage('‚úÖ Contact marked as contacted successfully!');
            } catch (error) {
                console.error('Error updating contact:', error);
                showErrorMessage('Failed to update contact: ' + error.message);
            }
        }

        // Mark as new
        async function markAsNew(contactId) {
            if (!firebaseInitialized) {
                showErrorMessage('Firebase not connected');
                return;
            }

            try {
                await db.collection('contacts').doc(contactId).update({
                    status: 'new'
                });
                showSuccessMessage('‚úÖ Contact marked as new successfully!');
            } catch (error) {
                console.error('Error updating contact:', error);
                showErrorMessage('Failed to update contact: ' + error.message);
            }
        }

        // Delete contact
        async function deleteContact(contactId) {
            const confirmed = await showCustomConfirm(
                'Are you sure you want to delete this contact?<br><br><strong>This action cannot be undone.</strong>',
                'Delete Contact',
                'üóëÔ∏è'
            );
            
            if (!confirmed) {
                return;
            }

            if (!firebaseInitialized) {
                showErrorMessage('Firebase not connected');
                return;
            }

            try {
                await db.collection('contacts').doc(contactId).delete();
                showSuccessMessage('‚úÖ Contact deleted successfully!');
            } catch (error) {
                console.error('Error deleting contact:', error);
                showErrorMessage('Failed to delete contact: ' + error.message);
            }
        }

        // Load banner data specifically
        async function loadBannerData() {
            if (!firebaseInitialized) {
                loadBannerFromLocalStorage();
                return;
            }

            try {
                // Load banner text data (title and subtitle)
                const bannerDoc = await db.collection('admin').doc('banner').get();
                const bannerData = bannerDoc.data();
                
                // Check if document exists by checking if data exists
                if (bannerData) {
                    console.log('Banner data loaded from Firestore:', bannerData);
                    // Always set the values, even if they're empty strings
                    document.getElementById('bannerTitle').value = bannerData.title || '';
                    document.getElementById('bannerSubtitle').value = bannerData.subtitle || '';
                    
                    // Load background image
                    if (bannerData.backgroundImage) {
                        const urlInput = document.getElementById('bannerBackgroundImageUrl');
                        const preview = document.getElementById('bannerBackgroundImagePreview');
                        const img = preview.querySelector('img');
                        
                        // Check if it's a URL (starts with http:// or https://)
                        if (bannerData.backgroundImage.startsWith('http://') || bannerData.backgroundImage.startsWith('https://')) {
                            if (urlInput) urlInput.value = bannerData.backgroundImage;
                            if (img) {
                                img.src = bannerData.backgroundImage;
                                preview.style.display = 'block';
                            }
                        } else {
                            // It's a base64 data URL, clear the URL input but show preview
                            if (urlInput) urlInput.value = '';
                            if (img) {
                                img.src = bannerData.backgroundImage;
                                preview.style.display = 'block';
                            }
                        }
                    } else {
                        // No background image, clear preview
                        const preview = document.getElementById('bannerBackgroundImagePreview');
                        if (preview) preview.style.display = 'none';
                        const urlInput = document.getElementById('bannerBackgroundImageUrl');
                        if (urlInput) urlInput.value = '';
                    }
                } else {
                    console.log('Banner document does not exist, loading from localStorage');
                    loadBannerFromLocalStorage();
                }
            } catch (error) {
                console.error('Error loading banner data:', error);
                loadBannerFromLocalStorage();
            }
        }


        // Load personal info data specifically
        async function loadPersonalInfoData() {
            if (!firebaseInitialized) {
                loadPersonalInfoFromLocalStorage();
                return;
            }

            try {
                const personalInfoDoc = await db.collection('admin').doc('personalInfo').get();
                const personalInfo = personalInfoDoc.data();
                
                // Check if document exists by checking if data exists
                if (personalInfo) {
                    console.log('Personal info loaded from Firestore:', personalInfo);
                    
                    // Always set the values, even if they're empty strings
                    // This will overwrite any localStorage values
                    const nameField = document.getElementById('consultantName');
                    const titleField = document.getElementById('consultantTitle');
                    
                    if (nameField) nameField.value = personalInfo.name || '';
                    if (titleField) titleField.value = personalInfo.title || '';
                    
                    // Update localStorage with Firestore data to keep them in sync
                    localStorage.setItem('personalInfo', JSON.stringify({
                        name: personalInfo.name || '',
                        title: personalInfo.title || '',
                        image: personalInfo.image || ''
                    }));
                    
                    // Handle image URL - only show URL in input field if it's a URL
                    const urlInput = document.getElementById('profileImageUrl');
                    if (personalInfo.image) {
                        // Check if it's a URL (starts with http:// or https://)
                        if (personalInfo.image.startsWith('http://') || personalInfo.image.startsWith('https://')) {
                            if (urlInput) urlInput.value = personalInfo.image; // Show URL in the input field
                        } else {
                            // It's a base64 data URL, clear the URL input
                            if (urlInput) urlInput.value = '';
                        }
                    } else {
                        // No image, clear URL input
                        if (urlInput) urlInput.value = '';
                    }
                } else {
                    console.log('Personal info document does not exist, loading from localStorage');
                    loadPersonalInfoFromLocalStorage();
                }
            } catch (error) {
                console.error('Error loading personal info:', error);
                showErrorMessage('Failed to load personal info: ' + error.message);
                loadPersonalInfoFromLocalStorage();
            }
        }


        // Load admin data from Firestore
        async function loadAdminDataFromFirestore() {
            if (!firebaseInitialized) {
                loadDataFromLocalStorage();
                return;
            }

            try {
                // Load banner data
                await loadBannerData();

                // Load other admin data
                await loadPersonalInfoData();
            } catch (error) {
                console.error('Error loading admin data from Firestore:', error);
                loadDataFromLocalStorage();
            }
        }

        // Load data from localStorage (fallback)
        function loadDataFromLocalStorage() {
            loadBannerFromLocalStorage();
            loadPersonalInfoFromLocalStorage();
        }

        function loadBannerFromLocalStorage() {
            const bannerData = JSON.parse(localStorage.getItem('bannerData') || '{}');
            document.getElementById('bannerTitle').value = bannerData.title || '';
            document.getElementById('bannerSubtitle').value = bannerData.subtitle || '';
            
            // Load background image
            if (bannerData.backgroundImage) {
                const urlInput = document.getElementById('bannerBackgroundImageUrl');
                const preview = document.getElementById('bannerBackgroundImagePreview');
                const img = preview.querySelector('img');
                
                // Check if it's a URL (starts with http:// or https://)
                if (bannerData.backgroundImage.startsWith('http://') || bannerData.backgroundImage.startsWith('https://')) {
                    if (urlInput) urlInput.value = bannerData.backgroundImage;
                    if (img) {
                        img.src = bannerData.backgroundImage;
                        preview.style.display = 'block';
                    }
                } else {
                    // It's a base64 data URL, clear the URL input but show preview
                    if (urlInput) urlInput.value = '';
                    if (img) {
                        img.src = bannerData.backgroundImage;
                        preview.style.display = 'block';
                    }
                }
            } else {
                // No background image, clear preview
                const preview = document.getElementById('bannerBackgroundImagePreview');
                if (preview) preview.style.display = 'none';
                const urlInput = document.getElementById('bannerBackgroundImageUrl');
                if (urlInput) urlInput.value = '';
            }
        }

        function loadPersonalInfoFromLocalStorage() {
            const personalInfo = JSON.parse(localStorage.getItem('personalInfo') || '{}');
            document.getElementById('consultantName').value = personalInfo.name || '';
            document.getElementById('consultantTitle').value = personalInfo.title || '';
            
            const urlInput = document.getElementById('profileImageUrl');
            if (personalInfo.image) {
                // Check if it's a URL
                if (personalInfo.image.startsWith('http://') || personalInfo.image.startsWith('https://')) {
                    if (urlInput) urlInput.value = personalInfo.image;
                } else {
                    // It's a base64 data URL, clear the URL input
                    if (urlInput) urlInput.value = '';
                }
            } else {
                if (urlInput) urlInput.value = '';
            }
        }


        // Load saved data on page load
        window.addEventListener('load', function() {
            loadFirebaseConfig();
            // Only load from localStorage if Firebase is not initialized yet
            // Firebase initialization will load from Firestore and overwrite localStorage data
            if (!firebaseInitialized) {
                loadDataFromLocalStorage();
            }
            updateDashboard();
            
            // Initialize mobile menu state
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.add('mobile-hidden');
            }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('mobile-hidden');
            } else {
                sidebar.classList.add('mobile-hidden');
            }
        });
    </script>
</body>
</html>
